extend type Query {
  workspace(id: String!): Workspace!
    @hasServerRole(role: SERVER_GUEST)
    @hasScope(scope: "workspace:read")

  """
  Look for an invitation to a workspace, for the current user (authed or not).

  If token is specified, it will return the corresponding invite even if it belongs to a different user.

  Either token or workspaceId must be specified, or both
  """
  workspaceInvite(workspaceId: String, token: String): PendingWorkspaceCollaborator
}

input WorkspaceCreateInput {
  name: String!
  description: String
}

input WorkspaceUpdateInput {
  id: String!
  name: String
  description: String
  """
  Logo image as base64-encoded string
  """
  logo: String
}

input WorkspaceRoleUpdateInput {
  userId: String!
  workspaceId: String!
  """
  Leave role null to revoke access entirely
  """
  role: String
}

input WorkspaceRoleDeleteInput {
  userId: String!
  workspaceId: String!
}

input WorkspaceProjectInviteCreateInput {
  """
  Either this or userId must be filled
  """
  email: String
  """
  Either this or email must be filled
  """
  userId: String
  """
  Defaults to the contributor role, if not specified
  """
  role: String
  """
  Can only be specified if guest mode is on or if the user is an admin
  """
  serverRole: String
  """
  Only taken into account, if project belongs to a workspace. Defaults to guest access.
  """
  workspaceRole: String
}

extend type ProjectInviteMutations {
  """
  Create invite(-s) for a project in a workspace. Unlike the base create() mutation, this allows
  configuring the workspace role.
  """
  createForWorkspace(
    projectId: ID!
    inputs: [WorkspaceProjectInviteCreateInput!]!
  ): Project! @hasScope(scope: "users:invite") @hasServerRole(role: SERVER_USER)
}

extend type Mutation {
  workspaceMutations: WorkspaceMutations! @hasServerRole(role: SERVER_GUEST)
}

type WorkspaceMutations {
  create(input: WorkspaceCreateInput!): Workspace!
    @hasServerRole(role: SERVER_USER)
    @hasScope(scope: "workspace:create")
  delete(workspaceId: String!): Boolean!
    @hasScope(scope: "workspace:delete")
    @hasServerRole(role: SERVER_USER)
  update(input: WorkspaceUpdateInput!): Workspace!
    @hasScope(scope: "workspace:update")
    @hasServerRole(role: SERVER_USER)
  updateRole(input: WorkspaceRoleUpdateInput!): Workspace!
    @hasScope(scope: "workspace:update")
    @hasServerRole(role: SERVER_USER)
  leave(id: ID!): Boolean! @hasServerRole(role: SERVER_GUEST)
  invites: WorkspaceInviteMutations!
}

input WorkspaceInviteCreateInput {
  """
  Either this or userId must be filled
  """
  email: String
  """
  Either this or email must be filled
  """
  userId: String
  """
  Defaults to the member role, if not specified
  """
  role: WorkspaceRole
  """
  Defaults to User, if not specified
  """
  serverRole: ServerRole
}

input WorkspaceInviteUseInput {
  token: String!
  accept: Boolean!
  """
  If invite is attached to an unregistered email, the invite can only be used if this is set to true.
  Upon accepting such an invite, the unregistered email will be added to the user's account as well.
  """
  addNewEmail: Boolean
}

type WorkspaceInviteMutations {
  create(workspaceId: String!, input: WorkspaceInviteCreateInput!): Workspace!
    @hasScope(scope: "users:invite")
    @hasServerRole(role: SERVER_USER)
  batchCreate(workspaceId: String!, input: [WorkspaceInviteCreateInput!]!): Workspace!
    @hasScope(scope: "users:invite")
    @hasServerRole(role: SERVER_USER)
  use(input: WorkspaceInviteUseInput!): Boolean!
  cancel(workspaceId: String!, inviteId: String!): Workspace!
    @hasScope(scope: "users:invite")
    @hasServerRole(role: SERVER_USER)
}

input PendingWorkspaceCollaboratorsFilter {
  search: String
}

type Workspace {
  id: ID!
  name: String!
  description: String
  createdAt: DateTime!
  updatedAt: DateTime!
  """
  Logo image as base64-encoded string
  """
  logo: String
  """
  Active user's role for this workspace. `null` if request is not authenticated, or the workspace is not explicitly shared with you.
  """
  role: String
  team(filter: WorkspaceTeamFilter): [WorkspaceCollaborator!]!
  """
  Only available to workspace owners
  """
  invitedTeam(
    filter: PendingWorkspaceCollaboratorsFilter
  ): [PendingWorkspaceCollaborator!] @hasWorkspaceRole(role: ADMIN)
  projects(
    limit: Int! = 25
    cursor: String
    filter: WorkspaceProjectsFilter
  ): ProjectCollection!
}

input WorkspaceProjectsFilter {
  """
  Filter out projects by name
  """
  search: String
}

input WorkspaceTeamFilter {
  """
  Limit team members to provided role
  """
  role: String
  """
  Search for team members by name or email
  """
  search: String
}

type WorkspaceCollaborator {
  id: ID!
  role: String!
  user: LimitedUser!
}

type PendingWorkspaceCollaborator {
  id: ID!
  updatedAt: DateTime!
  inviteId: String!
  workspaceId: String!
  workspaceName: String!
  """
  E-mail address if target is unregistered or primary e-mail of target registered user
  if token was specified to retrieve this invite
  """
  email: String
  """
  E-mail address or name of the invited user
  """
  title: String!
  """
  Target workspace role
  """
  role: String!
  invitedBy: LimitedUser!
  """
  Set only if user is registered
  """
  user: LimitedUser
  """
  Only available if the active user is the pending workspace collaborator or if it was already
  specified when retrieving this invite
  """
  token: String
}

type WorkspaceCollection {
  totalCount: Int!
  cursor: String
  items: [Workspace!]!
}

extend type User {
  """
  Get the workspaces for the user
  """
  workspaces(
    limit: Int! = 25
    cursor: String = null
    filter: UserWorkspacesFilter
  ): WorkspaceCollection! @isOwner

  """
  Get all invitations to workspaces that the active user has
  """
  workspaceInvites: [PendingWorkspaceCollaborator!]
    @hasServerRole(role: SERVER_GUEST)
    @isOwner
}

extend type Project {
  workspace: Workspace
}

type ServerWorkspacesInfo {
  """
  This is a backend control variable for the workspaces feature set.
  Since workspaces need a backend logic to be enabled, this is not enough as a feature flag.
  """
  workspacesEnabled: Boolean!
}

extend type ServerInfo {
  workspaces: ServerWorkspacesInfo!
}

extend type AdminQueries {
  workspaceList(
    query: String
    limit: Int! = 25
    cursor: String = null
  ): WorkspaceCollection!
}

input UserWorkspacesFilter {
  search: String
}
