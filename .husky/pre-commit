#!/usr/bin/env sh
# shellcheck disable=SC1091
set -e

if [ -n "$CI" ]
then
  echo "running eslint"
  yarn eslint:projectwide
  echo "...eslint done"
  echo "running prettier"
  yarn prettier:check
  echo "...prettier done"
else
# shellcheck disable=SC1090
  . "$(dirname "$0")/_/husky.sh"
  yarn lint-staged
fi


check_dependencies_available() {
  echo "üîç looking for additional linter dependencies"
  for i in "${@}"
  do
    if ! command "${i}"; then
      echo "No ${i} executable found skipping additional checks" >&2
      exit 0
    fi
  done
  echo "‚úÖ All additional dependencies found"
}

additional_dependencies=""
if [ -z "${CI}" ]; then
  additional_dependencies=" ggshield"
fi

# shellcheck disable=SC2086
check_dependencies_available pre-commit hadolint helm shellcheck circleci${additional_dependencies}

echo "‚ñ∂Ô∏è Running pre-commit hooks"
pre-commit run --all-files
